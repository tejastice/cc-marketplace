---
name: tmux-single-agent
description: tmuxで1つのAIエージェント（Claude/Gemini/Codex）に質問する際に使用。シンプルな単一エージェント操作時に活用。
allowed-tools: Bash, Read
user-invocable: true
---

# tmux シングルエージェント操作スキル

tmux上で1つのAIエージェント（Claude Code, Gemini CLI, Codex）を使って質問に答えてもらうためのシンプルなスキル。

## 作業フロー

```
┌─────────────────────────────────────────────────────────────┐
│ 1. エージェント選択                                          │
│    Claude Code / Gemini CLI / Codex から選択               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 2. tmuxペイン準備                                            │
│    新規ペイン作成 or 既存ペイン使用                         │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 3. CLI起動（必要な場合）                                     │
│    - Claude: claude                                          │
│    - Gemini: gemini -y                                       │
│    - Codex: codex --full-auto                                │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 4. 質問送信                                                  │
│    シンプルに質問を送信（Professor Synapseなし）            │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 5. 完了確認（tail -12）                                      │
│    プロンプト表示で完了判定                                  │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 6. 回答取得                                                  │
│    response-extractorエージェントで回答を抽出               │
└─────────────────────────────────────────────────────────────┘
```

## セキュリティ：最重要ルール

### チェーンコマンドは絶対に使わない

```bash
# ❌ 危険：チェーンコマンド
tmux split-window -h && tmux send-keys -t 1 'claude'

# ✅ 安全：個別実行
tmux split-window -h
tmux send-keys -t 1 'claude'
```

**理由**: `&&` や `;` を許可すると、悪意あるコマンドが混入する可能性がある。

## 推奨レイアウト（左右2分割）

```
┌──────────────────────┬──────────────────────┐
│                      │                      │
│ ペイン0: メイン      │ ペイン1: エージェント│
│                      │                      │
│                      │                      │
└──────────────────────┴──────────────────────┘
```

### レイアウト構築と起動

```bash
# 新しいペインを作成（左右分割）
tmux split-window -h -p 50

# エージェント別の起動コマンド
# Claude Code
tmux send-keys -t 1 'claude' C-m

# Gemini CLI（自動承認モード）
tmux send-keys -t 1 'gemini -y' C-m

# Codex（フルオートモード）
tmux send-keys -t 1 'codex --full-auto' C-m
```

## 質問テンプレート

**シンプルな質問形式（Professor Synapseなし）：**

```
追加ルール：
- 正確な情報を得るため、必要に応じてネット検索を活用してください
- 情報が不足している場合は質問してください。私が答えます
- わからないことは正直に「わからない」と伝えてください

背景：[今自分が何をしていて、なぜこの質問をしているのか]

質問：[質問内容]
```

### 質問送信例

```bash
# Claude Code（ペイン1）
tmux send-keys -t 1 '追加ルール：
- 正確な情報を得るため、必要に応じてネット検索を活用してください
- 情報が不足している場合は質問してください。私が答えます
- わからないことは正直に「わからない」と伝えてください

背景：Pythonでデータ分析を始めたいと思っています。

質問：Pythonでデータ分析を始める際に必要なライブラリを教えてください'
tmux send-keys -t 1 C-m
```

### ファイル参照を含む質問（Claude Codeのみ）

```bash
# @ファイル参照が使える
tmux send-keys -t 1 '@README.md を読んで、このプロジェクトの概要を説明してください'
tmux send-keys -t 1 C-m
```

**注意**: Gemini CLIとCodexでは`@`ファイル参照は使えません。

## 各CLIの比較

| CLI | コマンド | 自動承認 | Enterキー | 完了時プロンプト | @ファイル参照 |
|-----|----------|----------|-----------|-----------------|--------------|
| Claude Code | `claude` | `--dangerously-skip-permissions` | `C-m` | `❯` | ✅ 可能 |
| Gemini CLI | `gemini` | `-y` / `--yolo` | `Enter` | `Type your message` | ❌ 不可 |
| OpenAI Codex | `codex` | `--full-auto` | `Enter` | `>` (行頭) | ❌ 不可 |

## 完了検知

```bash
# 完了確認（12行で十分）
tmux capture-pane -t 1 -p | tail -12

# プロンプトが表示されていれば処理完了
# - Claude Code: ❯
# - Gemini CLI: Type your message
# - Codex: > (行頭)
```

## 回答取得

response-extractorエージェントに依頼する：

```
「ペイン1の回答を取得して」
```

または直接キャプチャ：

```bash
# 最新200行を取得
tmux capture-pane -t 1 -p -S -200
```

## 追加のやりとり

```bash
# 追加質問を送信
tmux send-keys -t 1 '具体的には○○について教えてください'
tmux send-keys -t 1 C-m

# ネット検索を指示
tmux send-keys -t 1 '最新の情報をネットで検索して確認してください'
tmux send-keys -t 1 C-m
```

## コンテキスト節約のコツ

1. **完了確認は12行**: `tmux capture-pane -t 1 -p | tail -12`
2. **回答取得は必要な分だけ**: `-S -200` など行数を制限
3. **全履歴は本当に必要な時だけ**: `-S -` は控えめに

## 使い分けのガイド

### Claude Codeを選ぶ場合
- プロジェクト内のファイルを参照したい（`@ファイル名`）
- コード生成・編集が必要
- 複雑な推論が必要

### Gemini CLIを選ぶ場合
- Googleの最新情報が必要
- 素早い回答が欲しい
- マルチモーダル（画像+テキスト）の処理

### Codexを選ぶ場合
- OpenAI GPT-4の能力を使いたい
- 別の視点からの回答が欲しい

## ペイン番号の確認

```bash
# 現在のペイン一覧を確認
tmux list-panes -t agent -F "#{pane_index}: #{pane_current_command}"
```

## セッション管理

```bash
# セッション一覧
tmux list-sessions

# セッション名変更
tmux rename-session -t 0 agent

# セッション切り替え
tmux switch-client -t agent
```

---

詳細なコマンドリファレンスは `../tmux-multi-agent/reference.md` を参照。
