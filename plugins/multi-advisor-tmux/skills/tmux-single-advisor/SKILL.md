---
name: tmux-single-advisor
description: tmuxで1つのAIアドバイザー（Claude/Gemini/Codex）に質問する際に使用。シンプルな単一アドバイザー操作時に活用。
allowed-tools: Bash, Read
user-invocable: true
---

# tmux シングルアドバイザー操作スキル

tmux上で1つのAIアドバイザー（Claude Code, Gemini CLI, Codex）を使って質問に答えてもらうためのシンプルなスキル。

## 作業フロー

```
┌─────────────────────────────────────────────────────────────┐
│ 1. アドバイザー選択                                          │
│    Claude Code / Gemini CLI / Codex から選択               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 2. tmuxペイン準備                                            │
│    新規ペイン作成 or 既存ペイン使用                         │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 3. CLI起動（必要な場合）                                     │
│    - Claude: claude                                          │
│    - Gemini: gemini -y                                       │
│    - Codex: codex --full-auto                                │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 4. 準備メッセージ送信（第1段階）                             │
│    - Professor Synapseプロンプトを送信                      │
│    - 「準備ができたら教えてください」と伝える               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 5. 準備完了を確認                                            │
│    /multi-advisor-tmux:check コマンドで状態確認             │
│    Ready になるまで待つ                                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 6. 本題の質問送信（第2段階）                                 │
│    - 追加ルール（検索活用、質問歓迎、正直に回答）           │
│    - 背景（今何をしていて、なぜこの質問をしているか）       │
│    - 質問内容                                               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 7. 完了確認                                                  │
│    /multi-advisor-tmux:check コマンドで状態確認             │
│    Ready になれば処理完了                                    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 8. 回答取得                                                  │
│    response-extractorエージェントで回答を抽出               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 9. 追加質問の判断                                            │
│    - アドバイザーが質問してきた → 回答を送信                │
│    - 情報が不足 → 追加質問を送信                            │
│    - 回答が不正確 → ネット検索を指示                        │
│    - 満足 → 終了                                            │
└─────────────────────────────────────────────────────────────┘
                              ↓
                   （必要なら 7〜9 を繰り返し）
```

## セキュリティ：最重要ルール

### チェーンコマンドは絶対に使わない

```bash
# ❌ 危険：チェーンコマンド
tmux split-window -h && tmux send-keys -t 1 'claude'

# ✅ 安全：個別実行
tmux split-window -h
tmux send-keys -t 1 'claude'
```

**理由**: `&&` や `;` を許可すると、悪意あるコマンドが混入する可能性がある。

## 推奨レイアウト（左右2分割）

```
┌──────────────────────┬──────────────────────┐
│                      │                      │
│ ペイン0: メイン      │ ペイン1: アドバイザー│
│                      │                      │
│                      │                      │
└──────────────────────┴──────────────────────┘
```

### レイアウト構築と起動

**推奨：コマンドを使う**
```bash
# /multi-advisor-tmux:layout-single コマンドを使用
# シンプルな左右2分割レイアウトを構築し、CLI起動をガイド
```

**または手動で構築:**
```bash
# 新しいペインを作成（左右分割）
tmux split-window -h -p 50

# 重要：文字列入力とEnterキーは別々に送信する
# アドバイザー別の起動コマンド

# Claude Code
tmux send-keys -t 1 'claude'
tmux send-keys -t 1 C-m

# Gemini CLI（自動承認モード）
tmux send-keys -t 1 'gemini -y'
tmux send-keys -t 1 Enter

# Codex（フルオートモード）
tmux send-keys -t 1 'codex --full-auto'
tmux send-keys -t 1 Enter

# 起動を待つ
sleep 1

# CLIが入力受付状態になっているか確認
# ペインをキャプチャして、プロンプトが表示されているか目視確認
```

## 質問テンプレート（2段階方式）

### 第1段階：準備メッセージ

**Professor Synapseプロンプトを送信して準備完了を待つ:**

```
@professor_synapse.md を読んで、このプロンプトに従って動作してください。

準備ができたら教えてください。
```

### 第2段階：本題の質問

**準備完了後に本題の質問を送信:**

```
追加ルール：
- 正確な情報を得るため、必要に応じてネット検索を活用してください
- 情報が不足している場合は質問してください。私が答えます
- わからないことは正直に「わからない」と伝えてください

背景：[今自分が何をしていて、なぜこの質問をしているのか]

質問：[質問内容]
```

### 質問送信例（2段階）

**第1段階：準備メッセージ送信**

```bash
# Claude Code（ペイン1）
tmux send-keys -t 1 '@professor_synapse.md を読んで、このプロンプトに従って動作してください。

準備ができたら教えてください。'
tmux send-keys -t 1 C-m

# 準備完了を確認
/multi-advisor-tmux:check 1  # → "Ready" になるまで待つ
```

**第2段階：本題の質問送信**

```bash
# 本題の質問を送信（準備完了後）
tmux send-keys -t 1 '追加ルール：
- 正確な情報を得るため、必要に応じてネット検索を活用してください
- 情報が不足している場合は質問してください。私が答えます
- わからないことは正直に「わからない」と伝えてください

背景：Pythonでデータ分析を始めたいと思っています。

質問：Pythonでデータ分析を始める際に必要なライブラリを教えてください'
tmux send-keys -t 1 C-m

# 完了を確認
/multi-advisor-tmux:check 1  # → "Ready" になったら回答取得
```

**注意**:
- Gemini CLIとCodexでは`@`ファイル参照が使えないため、Professor Synapseプロンプトの内容を直接貼り付けてください
- ファイル参照は第2段階の質問に含めることができます（Claude Codeのみ）

**注意**: Gemini CLIとCodexでは`@`ファイル参照は使えません。

## 各CLIの比較

| CLI | コマンド | 自動承認 | Enterキー | 処理中の表示 | @ファイル参照 |
|-----|----------|----------|-----------|------------|--------------|
| Claude Code | `claude` | `--dangerously-skip-permissions` | `C-m` | `(ctrl+c to interrupt)`, `✻ <text>…` | ✅ 可能 |
| Gemini CLI | `gemini` | `-y` / `--yolo` | `Enter` | `(esc to cancel)`, スピナー | ❌ 不可 |
| OpenAI Codex | `codex` | `--full-auto` | `Enter` | `• Working`, `(esc to interrupt)` | ❌ 不可 |

**重要**: プロンプト文字（❯, ›, >）は処理中でも表示されるため、完了判定には使えない。

## 完了検知

**推奨：checkコマンドを使う（自動判定）**

```bash
# ペインの状態を確認
/multi-advisor-tmux:check 1  # → "Ready" / "Processing" / "Awaiting Permission" / "Error"
```

pane-status-checkerエージェント（Haikuモデル）が処理中表示の有無を判定し、状態を返す。

## 回答取得

response-extractorエージェントに依頼する：

```
「ペイン1の回答を取得して」
```

## 追加のやりとり

```bash
# 追加質問を送信
tmux send-keys -t 1 '具体的には○○について教えてください'
tmux send-keys -t 1 C-m

# ネット検索を指示
tmux send-keys -t 1 '最新の情報をネットで検索して確認してください'
tmux send-keys -t 1 C-m
```

## コンテキスト節約のコツ

1. **完了確認は /check コマンド**: サブエージェント（Haiku）で自動判定
2. **回答取得は response-extractor**: サブエージェントに抽出を任せる
3. **手動での tmux capture-pane は避ける**: サブエージェントを活用してコンテキスト節約

## Professor Synapseプロンプトについて

シングルアドバイザーでもProfessor Synapseプロンプトの使用を推奨します。

**メリット:**
- エージェントが専門家を召喚して適切な役割で回答
- 段階的に深掘りできる
- 不足情報を質問してくれる
- より正確で質の高い回答

**場所:** [../../prompts/professor_synapse.md](../../prompts/professor_synapse.md)

## 使い分けのガイド

### Claude Codeを選ぶ場合
- プロジェクト内のファイルを参照したい（`@ファイル名`）
- コード生成・編集が必要
- 複雑な推論が必要

### Gemini CLIを選ぶ場合
- Googleの最新情報が必要
- 素早い回答が欲しい
- マルチモーダル（画像+テキスト）の処理

### Codexを選ぶ場合
- OpenAI GPT-4の能力を使いたい
- 別の視点からの回答が欲しい

## ペイン番号の確認

```bash
# 現在のペイン一覧を確認
tmux list-panes -t agent -F "#{pane_index}: #{pane_current_command}"
```

## セッション管理

```bash
# セッション一覧
tmux list-sessions

# セッション名変更
tmux rename-session -t 0 agent

# セッション切り替え
tmux switch-client -t agent
```

---

詳細なドキュメント:
- コマンドリファレンス: [../../docs/command-reference.md](../../docs/command-reference.md)
- 使用例: [../../docs/examples.md](../../docs/examples.md)
