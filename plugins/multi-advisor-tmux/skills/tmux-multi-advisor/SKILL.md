---
name: tmux-multi-advisor
description: tmuxで複数AIアドバイザーを並列操作する際に使用。マルチアドバイザー、並列質問、tmux操作時に活用。
allowed-tools: Bash, Read
user-invocable: true
---

# tmux マルチアドバイザー操作スキル

tmux上で複数のAIアドバイザー（Claude Code, Gemini CLI, Codex）を並列で動かし、複数の視点からアドバイスを得るためのノウハウ集。

## 作業フロー

```
┌─────────────────────────────────────────────────────────────┐
│ 1. レイアウト構築                                            │
│    左メイン + 右3分割のペインを作成                          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 2. CLI起動                                                   │
│    ペイン1: claude  /  ペイン2: gemini -y  /  ペイン3: codex │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 3. 準備メッセージ送信（第1段階）                             │
│    - Professor Synapseプロンプトを送信                      │
│    - 「準備ができたら教えてください」と伝える               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 4. 準備完了を確認                                            │
│    /multi-advisor-tmux:check コマンドで各ペインの状態確認     │
│    全ペインが Ready になるまで待つ                           │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 5. 本題の質問送信（第2段階）                                 │
│    - 追加ルール（検索活用、質問歓迎、正直に回答）           │
│    - 背景（今何をしていて、なぜこの質問をしているか）       │
│    - 質問内容                                               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 6. 完了確認                                                  │
│    /multi-advisor-tmux:check コマンドで各ペインの状態確認     │
│    全ペインが Ready になれば処理完了                         │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 7. 回答取得                                                  │
│    response-extractorエージェントで回答を抽出               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ 8. 追加質問の判断                                            │
│    - アドバイザーが質問してきた → 回答を送信                │
│    - 情報が不足 → 追加質問を送信                            │
│    - 回答が不正確 → ネット検索を指示                        │
│    - 満足 → 終了                                            │
└─────────────────────────────────────────────────────────────┘
                              ↓
                   （必要なら 6〜8 を繰り返し）
```

## セキュリティ：最重要ルール

### チェーンコマンドは絶対に使わない

```bash
# ❌ 危険：チェーンコマンド
tmux split-window -h && tmux send-keys -t 1 'claude' && tmux select-pane -t 0

# ✅ 安全：個別実行
tmux split-window -h
tmux send-keys -t 1 'claude'
tmux select-pane -t 0
```

**理由**: `&&` や `;` を許可すると、悪意あるコマンドが混入する可能性がある。

## 推奨レイアウト（左メイン + 右3分割）

```
┌──────────────────────┬──────────────────────┐
│                      │ ペイン1: Claude Code │
│                      ├──────────────────────┤
│ ペイン0: メイン      │ ペイン2: Gemini CLI  │
│                      ├──────────────────────┤
│                      │ ペイン3: Codex       │
└──────────────────────┴──────────────────────┘
```

### レイアウト構築

**推奨：コマンドを使う**
```bash
# /multi-advisor-tmux:layout-multi コマンドを使用
# レイアウト構築とCLI起動をガイド付きで実行
```

**または手動で構築:**
```bash
# レイアウト構築
tmux split-window -h -p 50
tmux split-window -t 1 -v -p 67
tmux split-window -t 2 -v -p 50
tmux select-pane -t 0

# 各ペインでCLIを起動
# 重要：文字列入力とEnterキーは別々に送信する
tmux send-keys -t 1 'claude'
tmux send-keys -t 1 C-m
tmux send-keys -t 2 'gemini -y'
tmux send-keys -t 2 Enter
tmux send-keys -t 3 'codex --full-auto'
tmux send-keys -t 3 Enter

# 起動を待つ
sleep 1

# 各CLIが入力受付状態になっているか確認
# 各ペインをキャプチャして、プロンプトが表示されているか目視確認
```

### 初回メッセージ送信

**初回メッセージには以下を含める：**
- Professor Synapseプロンプト（`prompts/professor_synapse.md`）
- ネット検索を活用して正確な情報を得ること
- 情報不足なら質問してほしいこと
- わからないことは正直に伝えてほしいこと
- **背景：今何をしていて、なぜこの質問をしているのか**

**テンプレート：**
```
@professor_synapse.md を読んで、このプロンプトに従って動作してください。

追加ルール：
- 正確な情報を得るため、必要に応じてネット検索を活用してください
- 情報が不足している場合は質問してください。私が答えます
- わからないことは正直に「わからない」と伝えてください

背景：[今自分が何をしていて、なぜこの質問をしているのか]

質問：[質問内容]
```

**送信例：**
```bash
# Claude Code（ペイン1）
tmux send-keys -t 1 '@professor_synapse.md を読んで、このプロンプトに従って動作してください。

追加ルール：
- 正確な情報を得るため、必要に応じてネット検索を活用してください
- 情報が不足している場合は質問してください。私が答えます
- わからないことは正直に「わからない」と伝えてください

背景：私は今、注文住宅を建てようとしています。工務店との打ち合わせ前に、建築の基本的な流れを理解しておきたいと思っています。

質問：木造建築の基礎から上棟までの流れを教えてください'
tmux send-keys -t 1 C-m

# Gemini CLI（ペイン2）※@ファイル参照不可の場合はプロンプト内容を直接貼り付け
tmux send-keys -t 2 '同様のメッセージ'
tmux send-keys -t 2 Enter

# Codex（ペイン3）
tmux send-keys -t 3 '同様のメッセージ'
tmux send-keys -t 3 Enter
```

### 完了確認と回答取得

**推奨：checkコマンドを使う**
```bash
# 各ペインの状態を確認
/multi-advisor-tmux:check 1  # → "Ready" または "Processing" など
/multi-advisor-tmux:check 2
/multi-advisor-tmux:check 3

# 全ペインが Ready なら完了
```

**回答取得**
```bash
# response-extractorエージェントで回答を取得
# 「ペイン1の回答を取得して」と指示する
```

## 各CLIの比較

| CLI | コマンド | 自動承認 | Enterキー | 処理中の表示 |
|-----|----------|----------|-----------|------------|
| Claude Code | `claude` | `--dangerously-skip-permissions` | `C-m` | `(ctrl+c to interrupt)`, `✻ <text>…` |
| Gemini CLI | `gemini` | `-y` / `--yolo` | `Enter` | `(esc to cancel)`, スピナー |
| OpenAI Codex | `codex` | `--approval-mode full-auto` | `Enter` | `• Working`, `(esc to interrupt)` |

**重要**: プロンプト文字（❯, ›, >）は処理中でも表示されるため、完了判定には使えない。

## 完了検知

**推奨：checkコマンドを使う（自動判定）**

```bash
# 各ペインの状態を確認
/multi-advisor-tmux:check 1  # → "Ready" / "Processing" / "Awaiting Permission" / "Error"
/multi-advisor-tmux:check 2
/multi-advisor-tmux:check 3
```

pane-status-checkerエージェント（Haikuモデル）が処理中表示の有無を判定し、状態を返す。

**判定基準:**
- **Processing**: キャンセル可能表示、スピナー、`…`で終わるメッセージ
- **Ready**: 上記の処理中表示がすべてない

回答内容の取得は `response-extractor` エージェントを使用する。

## 追加のやりとり

アドバイザーは1回で完璧な回答を出すとは限らない。やりとりが必要な場合は追加情報を送信する。

```bash
# 追加情報を送信
tmux send-keys -t 1 '具体的には○○のケースについて教えてください'
tmux send-keys -t 1 C-m

# 回答を確認
tmux capture-pane -t 1 -p | tail -30
```

**やりとりの流れ:**
1. 初回質問を送信
2. 回答をキャプチャして確認
3. 不足があれば追加情報を送信
4. わからない情報があれば「ネットで検索して」と指示
5. 満足のいく回答が得られるまで繰り返し

**ネット検索の指示例:**
```bash
tmux send-keys -t 1 '最新の情報をネットで検索して確認してください'
tmux send-keys -t 1 C-m
```

## コンテキスト節約のコツ

1. **完了確認は /check コマンド**: サブエージェント（Haiku）で自動判定
2. **回答取得は response-extractor**: サブエージェントに抽出を任せる
3. **手動での tmux capture-pane は避ける**: サブエージェントを活用してコンテキスト節約

## 並列質問パターン

同じ質問を複数アドバイザーに送信して比較:

```bash
# 各コマンドを個別に実行
tmux send-keys -t 1 '質問内容'
tmux send-keys -t 1 C-m

tmux send-keys -t 2 '質問内容'
tmux send-keys -t 2 Enter

tmux send-keys -t 3 '質問内容'
tmux send-keys -t 3 Enter

# メインペインに戻る
tmux select-pane -t 0
```

---

詳細なドキュメント:
- コマンドリファレンス: [../../docs/command-reference.md](../../docs/command-reference.md)
- 使用例: [../../docs/examples.md](../../docs/examples.md)
